<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Motion  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>
    <a title="Motion  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">Motion Docs</a> (92% documented)</p>
        <div class="header-right">
          <form role="search" action="search.json">
            <input type="text" placeholder="Search documentation" data-typeahead>
          </form>
        </div>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">Motion Reference</a>
        <img id="carat" src="img/carat.png" alt=""/>
        Motion  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/Animation.html">Animation</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/AnimationGroup.html">AnimationGroup</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/BasicAnimation.html">BasicAnimation</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DecayAnimation.html">DecayAnimation</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SpringAnimation.html">SpringAnimation</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ValueAnimation.html">ValueAnimation</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Global%20Variables.html">Global Variables</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Global%20Variables.html#/s:6Motion25UIScrollViewDecayConstantSdvp">UIScrollViewDecayConstant</a>
              </li>
              <li class="nav-group-task">
                <a href="Global%20Variables.html#/s:6Motion33UIScrollViewRubberBandingConstantSdvp">UIScrollViewRubberBandingConstant</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/CALayer.html">CALayer</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/CGFloat.html">CGFloat</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/CGPoint.html">CGPoint</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/CGRect.html">CGRect</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/CGSize.html">CGSize</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Double.html">Double</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Float.html">Float</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/SIMD16.html">SIMD16</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/SIMD2.html">SIMD2</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/SIMD3.html">SIMD3</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/SIMD32.html">SIMD32</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/SIMD4.html">SIMD4</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/SIMD64.html">SIMD64</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/SIMD8.html">SIMD8</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Functions.html#/s:6Motion16CADisableActionsyyyyXEF">CADisableActions(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:6Motion4mabsyxxAA13SupportedSIMDRzlF">mabs(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:6Motion10rubberband_11coefficient10boundsSize07contentE0xx_xxxtAA26FloatingPointInitializableRzlF">rubberband(_:coefficient:boundsSize:contentSize:)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/CAKeyframeAnimationEmittable.html">CAKeyframeAnimationEmittable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/CAKeyframeAnimationValueConvertible.html">CAKeyframeAnimationValueConvertible</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/EquatableEnough.html">EquatableEnough</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/FloatingPointInitializable.html">FloatingPointInitializable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/SIMDRepresentable.html">SIMDRepresentable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols.html#/s:6Motion13SupportedSIMDP">SupportedSIMD</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/SupportedScalar.html">SupportedScalar</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/AnimationFrame.html">AnimationFrame</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Bezier.html">Bezier</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/DecayFunction.html">DecayFunction</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/EasingFunction.html">EasingFunction</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SpringFunction.html">SpringFunction</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <p><img src="https://github.com/b3ll/Motion/blob/main/Resources/Motion-Logo-Rendered-Optimized.gif?raw=true" alt="Motion"></p>

<p><img src="https://github.com/b3ll/Motion/workflows/Tests/badge.svg" alt="Tests">
<img src="https://github.com/b3ll/Motion/workflows/Docs/badge.svg" alt="Docs"></p>

<p>Motion is an animation engine for gesturally-driven user interfaces, animations, and interactions on iOS, macOS, and tvOS, and is powered by SIMD and written fully in Swift. Motion allows for easily creating physically-modeled, interruptible animations (i.e. springs, decays, etc.) that work hand-in-hand with gesture recognizers to make the most fluid and delightful interactions possible.</p>

<ul>
<li><a href="#usage">Usage</a>

<ul>
<li><a href="#animations">Animations</a></li>
<li><a href="#spring-animation">Spring Animation</a></li>
<li><a href="#decay-animation">Decay Animation</a></li>
<li><a href="#basic-animation">Basic Animation</a></li>
</ul></li>
<li><a href="#motion-vs-core-animation">Motion vs. Core Animation</a></li>
<li><a href="#interruptibility">Interruptibility</a></li>
<li><a href="#simd">SIMD</a></li>
<li><a href="#performance">Performance</a></li>
<li><a href="#additions">Additions</a>

<ul>
<li><a href="#rubberbanding">Rubberbanding</a></li>
<li><a href="#cakeyframeanimationemittable">CAKeyframeAnimationEmittable</a></li>
<li><a href="#action-disabling">Action Disabling</a></li>
<li><a href="#curve-graphing">Curve Graphing</a></li>
</ul></li>
<li><a href="#installation">Installation</a>

<ul>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#swift-package-manager">Swift Package Manager</a></li>
<li><a href="#xcframework">xcframework</a></li>
<li><a href="#xcode-subproject">Xcode Subproject</a></li>
</ul></li>
<li><a href="#example-project">Example Project</a></li>
<li><a href="#other-recommendations">Other Recommendations</a></li>
<li><a href="#license">License</a></li>
<li><a href="#thanks">Thanks</a></li>
<li><a href="#contact-info">Contact Info</a></li>
</ul>
<h1 id='usage' class='heading'>Usage</h1>

<p>API Documentation is <a href="https://b3ll.github.io/Motion">here</a></p>
<h2 id='animations' class='heading'>Animations</h2>

<p>Creating animations in Motion is relatively simple. Simply allocate the animation type that you want with the type that conforms to <code><a href="Protocols/SIMDRepresentable.html">SIMDRepresentable</a></code>, configure it, and call <code>start</code> to start it. For each frame the animation executes, its <code>onValueChanged</code> block will be called, and you&rsquo;ll be given the opportunity to assign that newly animated value to something.</p>

<p>By default, lots of types are already supported out of the box, including:</p>

<ul>
<li><code>Float</code></li>
<li><code>Double</code></li>
<li><code>CGFloat</code></li>
<li><code>CGPoint</code></li>
<li><code>CGSize</code></li>
<li><code>CGRect</code></li>
<li><code>SIMD2&lt;Float&gt;</code></li>
<li><code>SIMD2&lt;Double&gt;</code></li>
<li>… and many more.</li>
</ul>

<p>Calling <code>stop</code> will freeze it in place, without the need to query the <code>presentationLayer</code> on <code>CALayer</code> and set values, or worry about <code>fillMode</code>, or worry about anything really.</p>

<p>Whenever it&rsquo;s done, the completion block will be called.</p>

<p>The animations need to be held somewhere as they will stop running if they&rsquo;re deallocated. Also, due to the nature of how they execute blocks, be careful not to introduce retain cycles by not using a <code>weak self</code> or <code>unowned</code> animation inside the animation <code>onValueChanged</code> or <code>completion</code> block.</p>

<p>Here&rsquo;s some examples:</p>
<h3 id='spring-animation' class='heading'>Spring Animation</h3>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">springAnimation</span> <span class="o">=</span> <span class="kt">SpringAnimation</span><span class="o">&lt;</span><span class="kt">CGRect</span><span class="o">&gt;</span><span class="p">()</span>
<span class="n">springAnimation</span><span class="o">.</span><span class="nf">configure</span><span class="p">(</span><span class="nv">response</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span> <span class="nv">damping</span><span class="p">:</span> <span class="mf">0.64</span><span class="p">)</span>
<span class="n">springAnimation</span><span class="o">.</span><span class="n">toValue</span> <span class="o">=</span> <span class="kt">CGRect</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="mf">320.0</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mf">320.0</span><span class="p">)</span>
<span class="n">springAnimation</span><span class="o">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="kt">CGRect</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="o">-</span><span class="mf">200.0</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="o">-</span><span class="mf">200.0</span><span class="p">)</span>
<span class="n">springAnimation</span><span class="o">.</span><span class="nf">onValueChanged</span><span class="p">(</span><span class="nv">disableActions</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span> <span class="n">newValue</span> <span class="k">in</span>
    <span class="n">view</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="n">newValue</span>
<span class="p">}</span>
<span class="n">springAnimation</span><span class="o">.</span><span class="n">completion</span> <span class="o">=</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="k">in</span>
    <span class="c1">// all done</span>
    <span class="k">self</span><span class="p">?</span><span class="o">.</span><span class="nf">animationDone</span><span class="p">()</span>
<span class="p">}</span>
<span class="n">springAnimation</span><span class="o">.</span><span class="nf">start</span><span class="p">()</span>
</code></pre>

<p><strong>Note</strong>: Some of you may be wondering if it&rsquo;s a mistake that the <code>stiffness</code>, <code>damping</code>, <code>response</code>, or <code>dampingRatio</code> setters are private, however this is intentional. It&rsquo;s incredibly easy to mixup <code>damping</code> and <code>dampingRatio</code>, and using one over the other will lead to dramatically different results. In addition, you should only be configuring either <code>stiffness</code> and <code>damping</code> <strong>or</strong> <code>response</code> and <code>dampingRatio</code> as they&rsquo;re both two separate ways of configuring spring constants.</p>
<h3 id='decay-animation' class='heading'>Decay Animation</h3>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">decayAnimation</span> <span class="o">=</span> <span class="kt">DecayAnimation</span><span class="o">&lt;</span><span class="kt">CGPoint</span><span class="o">&gt;</span><span class="p">()</span>
<span class="n">decayAnimation</span><span class="o">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mf">2000.0</span><span class="p">)</span>
<span class="n">decayAnimation</span><span class="o">.</span><span class="n">onValueChanged</span> <span class="p">{</span> <span class="n">newValue</span> <span class="k">in</span>
    <span class="n">view</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">newValue</span>
<span class="p">}</span>
<span class="n">decayAnimation</span><span class="o">.</span><span class="n">completion</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// all done</span>
<span class="p">}</span>
<span class="n">decayAnimation</span><span class="o">.</span><span class="nf">start</span><span class="p">()</span>
</code></pre>
<h3 id='basic-animation' class='heading'>Basic Animation</h3>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">basicAnimation</span> <span class="o">=</span> <span class="kt">BasicAnimation</span><span class="o">&lt;</span><span class="kt">CGFloat</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">easingFunction</span><span class="p">:</span> <span class="o">.</span><span class="n">easeInOut</span><span class="p">)</span>
<span class="n">basicAnimation</span><span class="o">.</span><span class="n">fromValue</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="n">basicAnimation</span><span class="o">.</span><span class="n">toValue</span> <span class="o">=</span> <span class="mf">200.0</span>
<span class="n">basicAnimation</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">basicAnimation</span><span class="o">.</span><span class="n">onValueChanged</span> <span class="p">{</span> <span class="n">newValue</span> <span class="k">in</span>
    <span class="n">view</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">newValue</span>
<span class="p">}</span>
<span class="n">basicAnimation</span><span class="o">.</span><span class="n">completion</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// all done</span>
<span class="p">}</span>
<span class="n">basicAnimation</span><span class="o">.</span><span class="nf">start</span><span class="p">()</span>
</code></pre>

<p><strong>Note</strong>: All of these animations are to run and be interfaced with on the <strong>main thread only</strong>. There is no support for threading of any kind.</p>
<h1 id='motion-vs-core-animation' class='heading'>Motion vs. Core Animation</h1>

<p>Motion is not designed to be a general-purpose replacement for Core Animation. Core Animation animations are run in a special way, in another process, outside of your app and are designed to be smooth even when the main thread is being heavily used. Motion on the other head is all run in-process (like a game engine), and using it liberally without considering heavy stack traces, will result in poor performance and dropped frames. Motion itself is not slow (in fact it&rsquo;s really <a href="#performance">fast</a>!), but calling methods to change view / layer properties or change layout at 60 FPS (or more) can be really taxing if not done carefully.</p>

<p><strong>tl;dr</strong>: Treat Motion animations as you would a <code>UIScrollView</code> (since scrolling animations behave the same way). If you have too much going on in your <code>UIScrollView</code> it&rsquo;ll lag when it scrolls; the same applies to Motion.</p>

<p>Some key tips:</p>

<ul>
<li>Measure text / layout asychronously, and then commit those changes back to the main thread whenever possible.</li>
<li>Layout a view controller fully before presenting (rather than during presenting) using <code>setNeedsDisplay()</code> and <code>layoutIfNeeded()</code>.</li>
<li>Avoid expensive operations during gestures / handing off from gestures.</li>
<li>If you can&rsquo;t optimize things any further, using <a href="#cakeyframeanimationemittable"><code><a href="Protocols/CAKeyframeAnimationEmittable.html">CAKeyframeAnimationEmittable</a></code></a> will help, and that&rsquo;s outlined later in this guide.</li>
</ul>
<h1 id='interruptibility' class='heading'>Interruptibility</h1>

<p>Motion is designed out of the box to make interruptible animations much easier. Interruptibility is when you have the ability to interrupt an animation in flight so you can stop, change, or restart it. Normally, with <code>UIView</code> block-based animations, or Core Animation based animations, this is really difficult to do (need to cancel the animation, figure out its current state on screen, apply that, etc.). <code>UIViewPropertyAnimator</code> works okay for this, but it relies heavily on &ldquo;scrubbing&rdquo; animations, which when working with physically-based animations (i.e. springs), that doesn&rsquo;t really make a lot of sense, since the physics are what generate the animation dynamically (vs. some predefined easing curve you can scrub).</p>

<p>Motion makes things like this easy, so you have to worry less about syncing up animation state with gestures, and focus more about the interactions themselves.</p>

<p>Here&rsquo;s an example of how a drag to a spring animation and then catching and redirecting that animation could look like:</p>

<p>Let&rsquo;s say you have a subview <code>view</code> inside another view (<code>self</code>).</p>
<pre class="highlight swift"><code><span class="c1">// Create a spring animation configured with our constants.</span>
<span class="k">var</span> <span class="nv">springAnimation</span><span class="p">:</span> <span class="kt">SpringAnimation</span><span class="o">&lt;</span><span class="kt">CGPoint</span><span class="o">&gt;</span><span class="p">()</span>
<span class="n">springAnimation</span><span class="o">.</span><span class="nf">configure</span><span class="p">(</span><span class="nv">response</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span> <span class="nv">damping</span><span class="p">:</span> <span class="mf">0.64</span><span class="p">)</span>

<span class="c1">// When you drag on the view and let go, it'll spring away from the center and then rebound back.</span>
<span class="c1">// At any point, you can grab the view and do it again.</span>
<span class="kd">func</span> <span class="nf">didPan</span><span class="p">(</span><span class="n">_</span> <span class="nv">gestureRecognizer</span><span class="p">:</span> <span class="kt">UIPanGestureRecognizer</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="n">gestureRecognizer</span><span class="o">.</span><span class="nv">state</span><span class="p">:</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">began</span><span class="p">:</span>
            <span class="n">springAnimation</span><span class="o">.</span><span class="nf">stop</span><span class="p">()</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">changed</span><span class="p">:</span>
            <span class="n">view</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">gestureRecognizer</span><span class="o">.</span><span class="nf">location</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
            <span class="n">springAnimation</span><span class="o">.</span><span class="nf">updateValue</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">view</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">ended</span><span class="p">:</span>
            <span class="n">springAnimation</span><span class="o">.</span><span class="n">toValue</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">center</span>
            <span class="n">springAnimation</span><span class="o">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="n">gestureRecognizer</span><span class="o">.</span><span class="nf">velocity</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
            <span class="n">springAnimation</span><span class="o">.</span><span class="n">onValueChanged</span> <span class="p">{</span> <span class="n">newValue</span> <span class="k">in</span>
                <span class="n">view</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">newValue</span>
            <span class="p">}</span>
            <span class="n">springAnimation</span><span class="o">.</span><span class="nf">start</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p><strong>Note</strong>: You can try this out in the example project (under the Dragging Demo).</p>
<h1 id='simd' class='heading'>SIMD</h1>

<p>SIMD powers a lot of how Motion works and avoids having to use more &ldquo;expensive&rdquo; objects like <code>NSValue</code> or <code>NSNumber</code> to animate. SIMD grants the ability to pack multiple values into a single SIMD register and then perform math on all those values simultaneously (Single Instruction Multiple Data). This means you can do neat things like animate a <code>CGRect</code> to another <code>CGRect</code> in a single super fast operation (rather than 4 separate operations: <code>x</code>, <code>y,</code>, <code>width</code>, <code>height</code>). It&rsquo;s not always the silver bullet, but on average, it&rsquo;s at least on par, and often faster than the naive implementation.</p>

<p>Motion exposes a protocol called <code><a href="Protocols/SIMDRepresentable.html">SIMDRepresentable</a></code> that allows for easy boxing and unboxing of values:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">point</span> <span class="o">=</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">simdPoint</span><span class="p">:</span> <span class="kt">SIMD2</span><span class="o">&lt;</span><span class="kt">CGFloat</span><span class="o">.</span><span class="kt">NativeType</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="nf">simdRepresentation</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">pointBoxedAgain</span> <span class="o">=</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="n">simdPoint</span><span class="p">)</span>
</code></pre>

<p>These conversions are relatively inexpensive, and Motion has been heavily optimized to avoid copying or boxing/unboxing them whenever it can.</p>

<p>For more information on SIMD, check out the <a href="https://developer.apple.com/documentation/accelerate/simd">docs</a>.</p>
<h1 id='performance' class='heading'>Performance</h1>

<p>Motion is pretty dang fast (especially on Apple Silicon!), leveraging some manual Swift optimization / specialization as well as SIMD it&rsquo;s capable of executing 5000 <code><a href="Classes/SpringAnimation.html">SpringAnimation&lt;SIMD64&lt;Double&gt;&gt;</a></code> in <strong>~130ms</strong> on an iPhone 12 Pro (that&rsquo;s 320,000 springs at 0.4 microseconds per spring!!). For smaller types like <code>CGFloat</code>, it can do the same thing in <strong>~1ms</strong>.</p>

<p>Is it as fast as it could be? Faster than some hand-optimized C++ or C implementation? Probably not.
That being said, it&rsquo;s definitely fast enough for interactions on devices and rarely (if ever) will be the bottleneck. I&rsquo;m also still no SIMD expert, so if anyone has some tips, I&rsquo;m sure it can go faster!</p>

<p><strong>tl;dr</strong>: SIMD go brrrrrrrrrrrrrrrrrrrrrrr</p>

<p>If you&rsquo;d like benchmark Motion on your own device, simply run the following from within the <code>Benchmark</code> folder:</p>
<pre class="highlight shell"><code>swift run -c release MotionBenchmarkRunner --time-unit ms
</code></pre>

<p>If you&rsquo;d like to run the benchmark on device, just launch the <code>MotionEample-iOS</code> app in <code>Release</code> mode with the <code>--benchmark</code> launch argument.</p>
<h1 id='additions' class='heading'>Additions</h1>

<p>Motion features some great additions to aid in creating interactions in general.</p>
<h2 id='rubberbanding' class='heading'>Rubberbanding</h2>

<p>Rubberbanding is the act of making values appear to be on a rubberband (they stretch and slip based on interaction). <code>UIScrollView</code> does this when you&rsquo;re pulling past the <code>contentSize</code> and by using the rubberband functions in Motion you can re-create this interaction for yourself. See the &ldquo;ScrollView Demo&rdquo; inside the example app for more info.</p>
<h2 id='cakeyframeanimationemittable' class='heading'>CAKeyframeAnimationEmittable</h2>

<p>All animations in Motion conform to <code><a href="Protocols/CAKeyframeAnimationEmittable.html">CAKeyframeAnimationEmittable</a></code> and that means that for any animation you configure, you can have it automatically generate a <code>CAKeyframeAnimation</code> that mirrors what would happen if you were to animate things using <code>start()</code>. The duration, and everything else is automatically calculated by running the animation from <code>value</code> to the resolved state. The only difference is <code>onValueChanged</code> and <code>completion</code> cannot be used, and you must specify a keypath to animate. There are also some helper methods to make this even easier (like adding any animation to a <code>CALayer</code> directly).</p>

<p>For example:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">springAnimation</span> <span class="o">=</span> <span class="kt">SpringAnimation</span><span class="o">&lt;</span><span class="kt">CGRect</span><span class="o">&gt;</span><span class="p">()</span>
<span class="n">springAnimation</span><span class="o">.</span><span class="nf">configure</span><span class="p">(</span><span class="nv">response</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span> <span class="nv">damping</span><span class="p">:</span> <span class="mf">0.64</span><span class="p">)</span>
<span class="n">springAnimation</span><span class="o">.</span><span class="n">toValue</span> <span class="o">=</span> <span class="kt">CGRect</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="mf">320.0</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mf">320.0</span><span class="p">)</span>
<span class="n">springAnimation</span><span class="o">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="kt">CGRect</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="o">-</span><span class="mf">200.0</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="o">-</span><span class="mf">200.0</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">keyframeAnimation</span> <span class="o">=</span> <span class="n">springAnimation</span><span class="o">.</span><span class="nf">keyframeAnimation</span><span class="p">()</span>
<span class="n">keyframeAnimation</span><span class="o">.</span><span class="n">keyPath</span> <span class="o">=</span> <span class="s">"frame"</span>
<span class="n">layer</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">keyframeAnimation</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="s">"MyAnimation"</span><span class="p">)</span>

<span class="c1">// or</span>

<span class="n">layer</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">springAnimation</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="s">"MyAnimation"</span><span class="p">,</span> <span class="nv">keyPath</span><span class="p">:</span> <span class="s">"frame"</span><span class="p">)</span>
</code></pre>

<p><strong>Note</strong>: If you remove or interrupt the animation and you want it to stay in place on screen, much like all other Core Animation animations, you&rsquo;ll need to grab the value from the layer&rsquo;s <code>presentationLayer</code> and apply that to the layer (as well as worry about <code>fillMode</code>).</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">frame</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="nf">presentationLayer</span><span class="p">()?</span><span class="o">.</span><span class="n">frame</span> <span class="p">??</span> <span class="n">layer</span><span class="o">.</span><span class="n">frame</span>
<span class="n">layer</span><span class="o">.</span><span class="nf">removeAnimation</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"MyAnimation"</span><span class="p">)</span>
<span class="kt">CADisableActions</span> <span class="p">{</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span>
<span class="p">}</span>
</code></pre>
<h2 id='action-disabling' class='heading'>Action Disabling</h2>

<p><code>CATransaction</code> is a really useful API but can easily break things if you forget to pair up <code>CATransaction.begin()</code> and <code>CATransaction.commit()</code> calls.</p>

<p><code>CADisableActions()</code> can be very helpful to reduce errors created when working with <code>CATransaction</code> to disable implicit animations:</p>
<pre class="highlight swift"><code><span class="kt">CADisableActions</span> <span class="p">{</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="p">}</span>

<span class="c1">// This is the same as calling:</span>

<span class="kt">CATransaction</span><span class="o">.</span><span class="nf">begin</span><span class="p">()</span>
<span class="kt">CATransaction</span><span class="o">.</span><span class="nf">setDisableActions</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="n">layer</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="kt">CATransaction</span><span class="o">.</span><span class="nf">commit</span><span class="p">()</span>
</code></pre>

<p>In addition, you can also disable implicit animations in every single <code>onValueChanged</code> invocation:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">springAnimation</span> <span class="o">=</span> <span class="kt">SpringAnimation</span><span class="o">&lt;</span><span class="kt">CGFloat</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">initialValue</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">springAnimation</span><span class="o">.</span><span class="nf">onValueChanged</span><span class="p">(</span><span class="nv">disableActions</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span> <span class="n">newValue</span> <span class="k">in</span>
    <span class="n">layer</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="n">newValue</span>
<span class="p">}</span>
<span class="n">springAnimation</span><span class="o">.</span><span class="nf">start</span><span class="p">()</span>
</code></pre>
<h2 id='curve-graphing' class='heading'>Curve Graphing</h2>

<p>Some initial work has been done to generate graphs to visualize a lot of these animations, and you&rsquo;ll find that in the Graphing package. It&rsquo;s still heavily a work in progress, but it is pretty neat for visualizing spring / decay functions.</p>
<h1 id='installation' class='heading'>Installation</h1>
<h2 id='requirements' class='heading'>Requirements</h2>

<ul>
<li>iOS 13+, macOS 10.15+</li>
<li>Swift 5.0 or higher</li>
</ul>

<p>Currently Motion supports Swift Package Manager, CocoaPods, Carthage, being used as an xcframework, and being used manually as an Xcode subproject. Pull requests for other dependency systems / build systems are welcome!</p>
<h2 id='swift-package-manager' class='heading'>Swift Package Manager</h2>

<p>Add the following to your <code>Package.swift</code> (or add it via Xcode&rsquo;s GUI):</p>
<pre class="highlight swift"><code><span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/b3ll/Motion"</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"0.0.3"</span><span class="p">)</span>
</code></pre>
<h2 id='xcframework' class='heading'>xcframework</h2>

<p>A built xcframework is available for each tagged release.</p>
<h2 id='xcode-subproject' class='heading'>Xcode Subproject</h2>

<p>Still working on this&hellip; (same with Carthage and Cocoapods). Pull Requests welcome!</p>
<h1 id='example-project' class='heading'>Example Project</h1>

<p>There&rsquo;s an example project available to try animations out and see how they work. Simply open the <code>MotionExample-iOS.xcodeproj</code> from within the <code>Example</code> directory.</p>
<h1 id='other-recommendations' class='heading'>Other Recommendations</h1>

<p>This library pairs very nicely with <a href="https://github.com/b3ll/Decomposed">Decomposed</a> if you wish to animate <code>CATransform3D</code> or access specific parts of it for your animations without worrying about the complex matrix math involved (i.e. <code>transform.translation.x</code>).</p>
<h1 id='license' class='heading'>License</h1>

<p>Motion is licensed under the <a href="https://github.com/b3ll/Motion/blob/master/LICENSE">BSD 2-clause license</a>.</p>
<h1 id='thanks' class='heading'>Thanks</h1>

<p>This project was definitely inspired by the wonderful people I&rsquo;ve had the experience of working with over the years as well as my appreciation of thoughtfully created and highly-crafted interfaces. In addition, the work done by @timdonnelly for <a href="https://github.com/timdonnelly/Advance">Advance</a> was a large inspiration for getting me started on this. I ended up writing this project as a means to further extend and just learn super in-depth all the mathematics and technical optimizations required to make a high-performance animation / interaction library. The more and more I iterated on it, the more I realized I was sharing the same mindset as I presume he did when writing Advance&hellip; brains are weird.</p>

<p>This project has had me really pushing the boundaries of my knowledge in terms of programming, Swift, animation, gestures, etc. and I&rsquo;m really happy to be sharing it with everyone so that they may be empowered to use it too.</p>

<p>If you have any questions, or want to learn more, feel free to ask me anything!</p>
<h1 id='contact-info' class='heading'>Contact Info</h1>

<p>Feel free to follow me on twitter: <a href="https://www.twitter.com/b3ll">@b3ll</a>!</p>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2022 <a class="link" href="https://twitter.com/b3ll" target="_blank" rel="external noopener">Adam Bell</a>. All rights reserved. (Last updated: 2022-05-23)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external noopener">jazzy ♪♫ v0.14.2</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external noopener">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</html>
